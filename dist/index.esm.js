export{default as BN}from"bn.js";import{sendAndConfirmRawTransaction as e,Connection as t,Account as n,PublicKey as r,TransactionInstruction as o,Transaction as i,SystemProgram as c,SYSVAR_RENT_PUBKEY as u}from"@solana/web3.js";import*as a from"@solana/web3.js";export{a as web3};import s from"camelcase";import{snakeCase as l}from"snake-case";import*as f from"js-sha256";import*as d from"@project-serum/borsh";import{inflate as p}from"pako";import h from"eventemitter3";import*as m from"bs58";import*as v from"base64-js";import*as y from"assert";import g from"assert";import{sha256 as w}from"crypto-hash";function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}function S(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,j(e,t)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function E(e,t,n){return(E=A()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&j(o,n.prototype),o}).apply(null,arguments)}function _(e){var t="function"==typeof Map?new Map:void 0;return(_=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return E(e,arguments,k(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),j(n,e)})(e)}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function B(e,t,n){if(!e.s){if(n instanceof O){if(!n.s)return void(n.o=B.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(B.bind(null,e,t),B.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var I=function(){function n(e,t,n){this.connection=e,this.wallet=t,this.opts=n}n.defaultOptions=function(){return{preflightCommitment:"recent",commitment:"recent"}},n.local=function(e,r){return r=r||n.defaultOptions(),new n(new t(e||"http://localhost:8899",r.preflightCommitment),M.local(),r)},n.env=function(){var e=require("process").env.ANCHOR_PROVIDER_URL;if(void 0===e)throw new Error("ANCHOR_PROVIDER_URL is not defined");var r=n.defaultOptions();return new n(new t(e,r.commitment),M.local(),r)};var r=n.prototype;return r.send=function(t,n,r){try{var o=this;void 0===n&&(n=[]),void 0===r&&(r=o.opts);var i=n.filter(function(e){return void 0!==e}),c=[o.wallet.publicKey].concat(i.map(function(e){return e.publicKey}));return t.setSigners.apply(t,c),Promise.resolve(o.connection.getRecentBlockhash(r.preflightCommitment)).then(function(n){return t.recentBlockhash=n.blockhash,Promise.resolve(o.wallet.signTransaction(t)).then(function(){i.forEach(function(e){t.partialSign(e)});var n=t.serialize();return Promise.resolve(e(o.connection,n,r))})})}catch(e){return Promise.reject(e)}},r.sendAll=function(t,n){try{var r=this;return void 0===n&&(n=r.opts),Promise.resolve(r.connection.getRecentBlockhash(n.preflightCommitment)).then(function(o){var i=t.map(function(e){var t=e.tx,n=e.signers;void 0===n&&(n=[]);var i=n.filter(function(e){return void 0!==e}),c=[r.wallet.publicKey].concat(i.map(function(e){return e.publicKey}));return t.setSigners.apply(t,c),t.recentBlockhash=o.blockhash,i.forEach(function(e){t.partialSign(e)}),t});return Promise.resolve(r.wallet.signAllTransactions(i)).then(function(t){var o=[],c=0,u=function(e,t,n){for(var r;;){var o=e();if(x(o)&&(o=o.v),!o)return i;if(o.then){r=0;break}var i=n();if(i&&i.then){if(!x(i)){r=1;break}i=i.s}if(t){var c=t();if(c&&c.then&&!x(c)){r=2;break}}}var u=new O,a=B.bind(null,u,2);return(0===r?o.then(l):1===r?i.then(s):c.then(f)).then(void 0,a),u;function s(r){i=r;do{if(t&&(c=t())&&c.then&&!x(c))return void c.then(f).then(void 0,a);if(!(o=e())||x(o)&&!o.v)return void B(u,1,i);if(o.then)return void o.then(l).then(void 0,a);x(i=n())&&(i=i.v)}while(!i||!i.then);i.then(s).then(void 0,a)}function l(e){e?(i=n())&&i.then?i.then(s).then(void 0,a):s(i):B(u,1,i)}function f(){(o=e())?o.then?o.then(l).then(void 0,a):l(o):B(u,1,i)}}(function(){return c<i.length},function(){return!!(c+=1)},function(){var i=t[c].serialize(),u=o.push;return Promise.resolve(e(r.connection,i,n)).then(function(e){u.call(o,e)})});return u&&u.then?u.then(function(){return o}):o})})}catch(e){return Promise.reject(e)}},r.simulate=function(e,t,n){try{var r=this;void 0===t&&(t=[]),void 0===n&&(n=r.opts);var o=t.filter(function(e){return void 0!==e}),i=[r.wallet.publicKey].concat(o.map(function(e){return e.publicKey}));return e.setSigners.apply(e,i),Promise.resolve(r.connection.getRecentBlockhash(n.preflightCommitment)).then(function(t){return e.recentBlockhash=t.blockhash,Promise.resolve(r.wallet.signTransaction(e)).then(function(){return o.forEach(function(t){e.partialSign(t)}),Promise.resolve(function(e,t,n){try{return Promise.resolve(e._recentBlockhash(e._disableBlockhashCaching)).then(function(r){t.recentBlockhash=r;var o=t.serializeMessage(),i=t._serialize(o).toString("base64");return Promise.resolve(e._rpcRequest("simulateTransaction",[i,{encoding:"base64",commitment:n}])).then(function(e){if(e.error)throw new Error("failed to simulate transaction: "+e.error.message);return e.result})})}catch(e){return Promise.reject(e)}}(r.connection,e,n.commitment))})})}catch(e){return Promise.reject(e)}},n}(),O=function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{B(r,1,i(this.v))}catch(e){B(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?B(r,1,t?t(o):o):n?B(r,1,n(o)):B(r,2,o)}catch(e){B(r,2,e)}},r},e}();function x(e){return e instanceof O&&1&e.s}var M=function(){function e(e){this.payer=e}e.local=function(){return new e(new n(Buffer.from(JSON.parse(require("fs").readFileSync(require("os").homedir()+"/.config/solana/id.json",{encoding:"utf-8"})))))};var t=e.prototype;return t.signTransaction=function(e){try{return e.partialSign(this.payer),Promise.resolve(e)}catch(e){return Promise.reject(e)}},t.signAllTransactions=function(e){try{var t=this;return Promise.resolve(e.map(function(e){return e.partialSign(t.payer),e}))}catch(e){return Promise.reject(e)}},P(e,[{key:"publicKey",get:function(){return this.payer.publicKey}}]),e}(),R=function(e){function t(){return e.apply(this,arguments)||this}return S(t,e),t}(_(Error)),K=function(e){function t(t,n){var r;return(r=e.call.apply(e,[this].concat([].slice.call(arguments,2)))||this).code=t,r.msg=n,r}return S(t,e),t.prototype.toString=function(){return this.msg},t}(_(Error)),T=function(e){try{return Promise.resolve(Buffer.from(f.digest("account:"+e)).slice(0,8))}catch(e){return Promise.reject(e)}},C=function(e){try{return Promise.resolve(Buffer.from(f.digest("account:"+e)).slice(0,8))}catch(e){return Promise.reject(e)}},W=function(){function e(e){this.instruction=new D(e),this.accounts=new N(e),this.types=new q(e),this.events=new U(e),e.state&&(this.state=new F(e))}return e.prototype.sighash=function(e,t){return V(e,t)},e}(),D=function(){function e(t){this.ixLayout=e.parseIxLayout(t)}var t=e.prototype;return t.encode=function(e,t){return this._encode("global",e,t)},t.encodeState=function(e,t){return this._encode("state",e,t)},t._encode=function(e,t,n){var r=Buffer.alloc(1e3),o=s(t),i=this.ixLayout.get(o).encode(n,r),c=r.slice(0,i);return Buffer.concat([V(e,t),c])},e.parseIxLayout=function(e){var t=(e.state?e.state.methods:[]).map(function(t){var n=t.args.map(function(t){return J.fieldLayout(t,e.types)}),r=s(t.name);return[r,d.struct(n,r)]}).concat(e.instructions.map(function(t){var n=t.args.map(function(t){return J.fieldLayout(t,e.types)}),r=s(t.name);return[r,d.struct(n,r)]}));return new Map(t)},e}(),N=function(){function e(e){if(void 0!==e.accounts){var t=e.accounts.map(function(t){return[t.name,J.typeDefLayout(t,e.types)]});this.accountLayouts=new Map(t)}else this.accountLayouts=new Map}var t=e.prototype;return t.encode=function(e,t){try{var n=Buffer.alloc(1e3),r=this.accountLayouts.get(e).encode(t,n),o=n.slice(0,r);return Promise.resolve(C(e)).then(function(e){return Buffer.concat([e,o])})}catch(e){return Promise.reject(e)}},t.decode=function(e,t){var n=t.slice(8);return this.accountLayouts.get(e).decode(n)},e}(),q=function(){function e(e){if(void 0!==e.types){var t=e.types.map(function(t){return[t.name,J.typeDefLayout(t,e.types)]});this.layouts=new Map(t)}else this.layouts=new Map}var t=e.prototype;return t.encode=function(e,t){var n=Buffer.alloc(1e3),r=this.layouts.get(e).encode(t,n);return n.slice(0,r)},t.decode=function(e,t){return this.layouts.get(e).decode(t)},e}(),U=function(){function e(e){if(void 0!==e.events){var t=e.events.map(function(t){var n={name:t.name,type:{kind:"struct",fields:t.fields.map(function(e){return{name:e.name,type:e.type}})}};return[t.name,J.typeDefLayout(n,e.types)]});this.layouts=new Map(t)}else this.layouts=new Map}var t=e.prototype;return t.encode=function(e,t){var n=Buffer.alloc(1e3),r=this.layouts.get(e).encode(t,n);return n.slice(0,r)},t.decode=function(e,t){return this.layouts.get(e).decode(t)},e}(),F=function(){function e(e){if(void 0===e.state)throw new Error("Idl state not defined.");this.layout=J.typeDefLayout(e.state.struct,e.types)}var t=e.prototype;return t.encode=function(e,t){try{var n=Buffer.alloc(1e3),r=this.layout.encode(t,n);return Promise.resolve(T(e)).then(function(e){var t=n.slice(0,r);return Buffer.concat([e,t])})}catch(e){return Promise.reject(e)}},t.decode=function(e){var t=e.slice(8);return this.layout.decode(t)},e}(),J=function(){function e(){}return e.fieldLayout=function(t,n){var r=void 0!==t.name?s(t.name):void 0;switch(t.type){case"bool":return d.bool(r);case"u8":return d.u8(r);case"u16":return d.u16(r);case"u32":return d.u32(r);case"u64":return d.u64(r);case"i64":return d.i64(r);case"u128":return d.u128(r);case"i128":return d.i128(r);case"bytes":return d.vecU8(r);case"string":return d.str(r);case"publicKey":return d.publicKey(r);default:if(t.type.vec)return d.vec(e.fieldLayout({name:void 0,type:t.type.vec},n),r);if(t.type.option)return d.option(e.fieldLayout({name:void 0,type:t.type.option},n),r);if(t.type.defined){if(void 0===n)throw new R("User defined types not provided");var o=n.filter(function(e){return e.name===t.type.defined});if(1!==o.length)throw new R("Type not found: "+JSON.stringify(t));return e.typeDefLayout(o[0],n,r)}if(t.type.array){var i=t.type.array[1],c=e.fieldLayout({name:void 0,type:t.type.array[0]},n);return d.array(c,i,r)}throw new Error("Not yet implemented: "+t)}},e.typeDefLayout=function(t,n,r){if("struct"===t.type.kind){var o=t.type.fields.map(function(t){return e.fieldLayout(t,n)});return d.struct(o,r)}if("enum"===t.type.kind){var i=t.type.variants.map(function(t){var r=s(t.name);if(void 0===t.fields)return d.struct([],r);var o=t.fields.map(function(t){if(void 0===t.name)throw new Error("Tuple enum variants not yet implemented.");return e.fieldLayout(t,n)});return d.struct(o,r)});return void 0!==r?d.rustEnum(i).replicate(r):d.rustEnum(i,r)}throw new Error("Unknown type kint: "+t)},e}();function z(e,t){switch(t){case"bool":case"u8":case"i8":return 1;case"u16":return 2;case"u32":return 4;case"u64":case"i64":return 8;case"u128":case"i128":return 16;case"bytes":case"string":return 1;case"publicKey":return 32;default:if(void 0!==t.vec)return 1;if(void 0!==t.option)return 1+z(e,t.option);if(void 0!==t.defined){var n=e.types.filter(function(e){return e.name===t.defined});if(1!==n.length)throw new R("Type not found: "+JSON.stringify(t));return $(e,n[0])}if(void 0!==t.array){var r=t.array[1];return z(e,t.array[0])*r}throw new Error("Invalid type "+JSON.stringify(t))}}function $(e,t){if("enum"===t.type.kind){var n=t.type.variants.map(function(t){return void 0===t.fields?0:t.fields.map(function(t){if(void 0===t.name)throw new Error("Tuple enum variants not yet implemented.");return z(e,t.type)}).reduce(function(e,t){return e+t})});return Math.max.apply(Math,n)+1}return void 0===t.type.fields?0:t.type.fields.map(function(t){return z(e,t.type)}).reduce(function(e,t){return e+t})}function V(e,t){var n=l(t);return Buffer.from(f.digest(e+"::"+n)).slice(0,8)}var H=function(e){try{return Promise.resolve(r.findProgramAddress([],e)).then(function(t){return Promise.resolve(r.createWithSeed(t[0],"anchor:idl",e))})}catch(e){return Promise.reject(e)}},Q=d.struct([d.publicKey("authority"),d.vecU8("data")]);function G(e){var t=[].slice.call(arguments,1);if(e.args.length!=t.length)throw new Error("Invalid argument length");var n={},r=0;return e.args.forEach(function(e){n[e.name]=t[r],r+=1}),n}function X(e,t){e.forEach(function(e){if(void 0!==e.accounts)X(e.accounts,t[e.name]);else if(void 0===t[e.name])throw new Error("Invalid arguments: "+e.name+" not provided.")})}function Z(e,t){var n=t.toString().split("custom program error: ");if(2===n.length)try{var r=parseInt(n[1]),o=e.get(r);return void 0===o?null:new K(r,o)}catch(e){return null}}function Y(e,t){var n={},r=e.args?e.args.length:0;if(t.length>r){if(t.length!==r+1)throw new Error("provided too many arguments ${args}");n=t.pop()}return[t,n]}var ee=function(){function e(){}return e.build=function(t,n,r){if("_inner"===t.name)throw new R("the _inner name is reserved");var i=function(){var i=[].slice.call(arguments),c=Y(t,[].concat(i)),u=c[0],a=c[1];X(t.accounts,a.accounts),te.apply(void 0,[t].concat(i));var s=e.accountsArray(a.accounts,t.accounts);return void 0!==a.remainingAccounts&&s.push.apply(s,a.remainingAccounts),a.__private&&a.__private.logAccounts&&console.log("Outgoing account metas:",s),new o({keys:s,programId:r,data:n.instruction.encode(t.name,G.apply(void 0,[t].concat(u)))})};return i.accounts=function(n){return e.accountsArray(n,t.accounts)},i},e.accountsArray=function(t,n){return n.map(function(n){var r=n.accounts;return void 0!==r?e.accountsArray(t[n.name],r).flat():{pubkey:t[n.name],isWritable:n.isMut,isSigner:n.isSigner}}).flat()},e}();function te(e){}function ne(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var re=function(e){try{return Promise.resolve(r.findProgramAddress([],e)).then(function(t){return r.createWithSeed(t[0],"unversioned",e)})}catch(e){return Promise.reject(e)}},oe=function(){function e(){}return e.build=function(e,t,n,a,s){if(void 0!==e.state){var l=function(){try{return Promise.resolve(re(n)).then(function(n){return Promise.resolve(s.connection.getAccountInfo(n)).then(function(r){if(null===r)throw new Error("Account does not exist "+n.toString());return Promise.resolve(T(e.state.struct.name)).then(function(e){if(e.compare(r.data.slice(0,8)))throw new Error("Invalid account discriminator");return t.state.decode(r.data)})})})}catch(e){return Promise.reject(e)}},f={},d={};e.state.methods.forEach(function(e){var l=function(t){try{return Promise.resolve(function(e,t,n,o){try{return"new"===n.name?Promise.resolve(r.findProgramAddress([],e)).then(function(n){var r=n[0],o={pubkey:t.wallet.publicKey,isWritable:!1,isSigner:!0};return Promise.resolve(re(e)).then(function(t){return[o,{pubkey:t,isWritable:!0,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:c.programId,isWritable:!1,isSigner:!1},{pubkey:e,isWritable:!1,isSigner:!1},{pubkey:u,isWritable:!1,isSigner:!1}]})}):(X(n.accounts,o),Promise.resolve(re(e)).then(function(e){return[{pubkey:e,isWritable:!0,isSigner:!1}]}))}catch(e){return Promise.reject(e)}}(n,s,e,t)).then(function(n){return n.concat(ee.accountsArray(t,e.accounts))})}catch(e){return Promise.reject(e)}},p=function(){try{var r=arguments,i=Y(e,[].concat([].slice.call(r))),c=i[0],u=i[1];return Promise.resolve(l(u.accounts)).then(function(r){return new o({keys:r,programId:n,data:t.instruction.encodeState(e.name,G.apply(void 0,[e].concat(c)))})})}catch(e){return Promise.reject(e)}};p.accounts=l,d[e.name]=p,f[e.name]=function(){try{var t=arguments,n=[].slice.call(t),r=Y(e,[].concat(n)),o=r[1],c=new i;void 0!==o.instructions&&c.add.apply(c,o.instructions);var u=c.add;return Promise.resolve(d[e.name].apply(d,n)).then(function(e){return u.call(c,e),ne(function(){return Promise.resolve(s.send(c,o.signers,o.options))},function(e){var t=Z(a,e);if(null===t)throw e;throw t})})}catch(e){return Promise.reject(e)}}}),l.rpc=f,l.instruction=d,l.address=function(){return re(n)};var p=null;return l.subscribe=function(e){if(null!==p)return p.ee;var n=new h;return l.address().then(function(r){var o=s.connection.onAccountChange(r,function(e){var r=t.state.decode(e.data);n.emit("change",r)},e);p={ee:n,listener:o}}),n},l.unsubscribe=function(){null!==p&&s.connection.removeAccountChangeListener(p.listener).then(function(){return p=null,Promise.resolve()}).catch(console.error)},l}},e}(),ie=function(){function e(){}return e.build=function(e,t){return function(){var n=[].slice.call(arguments),r=Y(e,[].concat(n)),o=r[1],c=new i;return void 0!==o.instructions&&c.add.apply(c,o.instructions),c.add(t.apply(void 0,n)),c}},e}();function ce(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var ue=function(){function e(){}return e.build=function(e,t,n,r){return function(){try{var o=arguments,i=[].slice.call(o),c=t.apply(void 0,i),u=Y(e,[].concat(i)),a=u[1];return Promise.resolve(ce(function(){return Promise.resolve(r.send(c,a.signers,a.options))},function(e){console.log("Translating error",e);var t=Z(n,e);if(null===t)throw e;throw t}))}catch(e){return Promise.reject(e)}}},e}(),ae=new Map,se=function(){function e(){}return e.build=function(e,t,n,o){var i={};return e.accounts.forEach(function(u){var a=s(u.name),l=function(e){try{return Promise.resolve(o.connection.getAccountInfo(e)).then(function(n){if(null===n)throw new Error("Account does not exist "+e.toString());return Promise.resolve(C(u.name)).then(function(e){if(e.compare(n.data.slice(0,8)))throw new Error("Invalid account discriminator");return t.accounts.decode(u.name,n.data)})})}catch(e){return Promise.reject(e)}};l.size=8+$(e,u),l.createInstruction=function(e,t){try{var r=l.size,i=c.createAccount,u=e.publicKey,a=o.wallet.publicKey;return Promise.resolve(o.connection.getMinimumBalanceForRentExemption(null!=t?t:r)).then(function(e){return i.call(c,{fromPubkey:a,newAccountPubkey:u,space:null!=t?t:r,lamports:e,programId:n})})}catch(e){return Promise.reject(e)}},l.subscribe=function(e,n){if(ae.get(e.toString()))return ae.get(e.toString()).ee;var r=new h,i=o.connection.onAccountChange(e,function(e){var n=t.accounts.decode(u.name,e.data);r.emit("change",n)},n);return ae.set(e.toString(),{ee:r,listener:i}),r},l.unsubscribe=function(e){var t=ae.get(e.toString());t?ae&&o.connection.removeAccountChangeListener(t.listener).then(function(){ae.delete(e.toString())}).catch(console.error):console.warn("Address is not subscribed")},l.all=function(e){try{return Promise.resolve(C(u.name)).then(function(i){return void 0!==e&&(i=Buffer.concat([i,e])),Promise.resolve(o.connection._rpcRequest("getProgramAccounts",[n.toBase58(),{commitment:o.connection.commitment,filters:[{memcmp:{offset:0,bytes:m.encode(i)}}]}])).then(function(e){if(e.error)throw console.error(e),new Error("Failed to get accounts");return e.result.map(function(e){var n=e.pubkey,o=e.account.data;return o=m.decode(o),{publicKey:new r(n),account:t.accounts.decode(u.name,o)}})})})}catch(e){return Promise.reject(e)}},l.associatedAddress=function(){try{var e=arguments,t=[Buffer.from([97,110,99,104,111,114])];return[].slice.call(e).forEach(function(e){t.push(e.toBuffer())}),Promise.resolve(r.findProgramAddress(t,n)).then(function(e){return e[0]})}catch(e){return Promise.reject(e)}},l.associated=function(){try{var e=arguments;return Promise.resolve(l.associatedAddress.apply(l,[].slice.call(e))).then(function(e){return Promise.resolve(l(e))})}catch(e){return Promise.reject(e)}},i[a]=l}),i},e}(),le="Program log: ".length,fe=function(){function e(e,t,n){this.coder=e,this.programId=t,this.discriminators=new Map(void 0===n.events?[]:n.events.map(function(e){return[v.fromByteArray((t=e.name,Buffer.from(f.digest("event:"+t)).slice(0,8))),e.name];var t}))}var t=e.prototype;return t.parseLogs=function(e,t){for(var n=new pe(e),r=new de(n.next()),o=n.next();null!==o;){var i=this.handleLog(r,o),c=i[0],u=i[1],a=i[2];c&&t(c),u&&r.push(u),a&&(r.pop(),n.next()),o=n.next()}},t.handleLog=function(e,t){return e.program()===this.programId.toString()?this.handleProgramLog(t):[null].concat(this.handleSystemLog(t))},t.handleProgramLog=function(e){if(e.startsWith("Program log:")){var t=e.slice(le),n=Buffer.from(v.toByteArray(t)),r=v.fromByteArray(n.slice(0,8)),o=null,i=this.discriminators.get(r);return void 0!==i&&(o={name:i,data:this.coder.events.decode(i,n.slice(8))}),[o,null,!1]}return[null].concat(this.handleSystemLog(e))},t.handleSystemLog=function(e){var t=e.split(":")[0];return t.startsWith("Program "+this.programId.toString()+" invoke")?[this.programId.toString(),!1]:t.includes("invoke")?["cpi",!1]:null!==t.match(/^Program (.*) consumed .*$/g)?[null,!0]:[null,!1]},e}(),de=function(){function e(e){var t=/^Program (.*) invoke.*$/g.exec(e)[1];this.stack=[t]}var t=e.prototype;return t.program=function(){return y.ok(this.stack.length>0),this.stack[this.stack.length-1]},t.push=function(e){this.stack.push(e)},t.pop=function(){y.ok(this.stack.length>0),this.stack.pop()},e}(),pe=function(){function e(e){this.logs=e}return e.prototype.next=function(){if(0===this.logs.length)return null;var e=this.logs[0];return this.logs=this.logs.slice(1),e},e}();function he(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var me=function(){function e(){}return e.build=function(e,t,n,r,o,i,c){return function(){try{var u,a=arguments,s=function(e){if(u)return e;if(void 0===h)throw new Error("Unable to simulate transaction");if(h.value.err)throw new Error("Simulate error: "+h.value.err.toString());var t=h.value.logs;if(!t)throw new Error("Simulated logs not found");var n=[];return c.events&&new fe(o,i,c).parseLogs(t,function(e){n.push(e)}),{events:n,raw:t}},l=[].slice.call(a),f=t.apply(void 0,l),d=Y(e,[].concat(l)),p=d[1],h=void 0,m=he(function(){return Promise.resolve(r.simulate(f,p.signers,p.options)).then(function(e){h=e})},function(e){console.log("Translating error",e);var t=Z(n,e);if(null===t)throw e;throw t});return Promise.resolve(m&&m.then?m.then(s):s(m))}catch(e){return Promise.reject(e)}}},e}(),ve=function(){function e(){}return e.build=function(e,t,n,r){var o=function(e){var t=new Map;return e.errors&&e.errors.forEach(function(e){var n,r=null!=(n=e.msg)?n:e.name;t.set(e.code,r)}),t}(e),i={},c={},u={},a={},l=oe.build(e,t,n,o,r);e.instructions.forEach(function(l){var f=ee.build(l,t,n),d=ie.build(l,f),p=ue.build(l,d,o,r),h=me.build(l,d,o,r,t,n,e),m=s(l.name);c[m]=f,u[m]=d,i[m]=p,a[m]=h});var f=e.accounts?se.build(e,t,n,r):{};return[i,c,u,f,l,a]},e}();new r("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA");var ye={bs58:m,sha256:w,getMultipleAccounts:function(e,t){try{var n=[t.map(function(e){return e.toBase58()}),{commitment:"recent"}];return Promise.resolve(e._rpcRequest("getMultipleAccounts",n)).then(function(e){if(e.error)throw new Error("failed to get info about accounts "+t.map(function(e){return e.toBase58()}).join(", ")+": "+e.error.message);g(void 0!==e.result);for(var n,o=[],i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e.result.value);!(n=i()).done;){var c=n.value,u=null;if(null===c)return void o.push(null);if(e.result.value){var a=c.executable,s=c.owner,l=c.lamports,f=c.data;g("base64"===f[1]),u={executable:a,owner:new r(s),lamports:l,data:Buffer.from(f[0],"base64")}}if(null===u)throw new Error("Invalid response");o.push(u)}return o.map(function(e,n){return null===e?null:{publicKey:t[n],account:e}})})}catch(e){return Promise.reject(e)}},idlAddress:H},ge=function(){function e(e,t,n){this._idl=e,this._programId=t,this._provider=null!=n?n:ke(),this._coder=new W(e);var r=ve.build(e,this._coder,t,this._provider),o=r[1],i=r[2],c=r[3],u=r[4],a=r[5];this.rpc=r[0],this.instruction=o,this.transaction=i,this.account=c,this.state=u,this.simulate=a}e.at=function(t,n){try{return Promise.resolve(e.fetchIdl(t,n)).then(function(r){return new e(r,t,n)})}catch(e){return Promise.reject(e)}},e.fetchIdl=function(e,t){try{var n;return t=null!=(n=t)?n:ke(),Promise.resolve(H(e)).then(function(e){return Promise.resolve(t.connection.getAccountInfo(e)).then(function(e){var t,n,r=(t=e.data.slice(8),Q.decode(t)),o=p(r.data);return JSON.parse((n=o,("undefined"==typeof TextDecoder?new(require("util").TextDecoder)("utf-8"):new TextDecoder("utf-8")).decode(n)))})})}catch(e){return Promise.reject(e)}};var t=e.prototype;return t.addEventListener=function(e,t){var n=new fe(this._coder,this._programId,this._idl);return this._provider.connection.onLogs(this._programId,function(r,o){r.err?console.error(r):n.parseLogs(r.logs,function(n){n.name===e&&t(n.data,o.slot)})})},t.removeEventListener=function(e){try{return Promise.resolve(this._provider.connection.removeOnLogsListener(e))}catch(e){return Promise.reject(e)}},P(e,[{key:"programId",get:function(){return this._programId}},{key:"idl",get:function(){return this._idl}},{key:"coder",get:function(){return this._coder}},{key:"provider",get:function(){return this._provider}}]),e}(),we=!1,be=new Proxy({},{get:function(e,t){var n=require("find"),o=require("fs"),i=require("process");if("undefined"==typeof window){if(!we){for(var c=require("path"),u=i.cwd();!o.existsSync(c.join(u,"Anchor.toml"));){var a=c.dirname(u);a===u&&(u=void 0),u=a}if(void 0===u)throw new Error("Could not find workspace root.");n.fileSync(/target\/idl\/.*\.json/,u).reduce(function(e,t){var n=o.readFileSync(t),i=JSON.parse(n);return e[s(i.name,{pascalCase:!0})]=new ge(i,new r(i.metadata.address)),e},e),we=!0}return e[t]}}}),Pe=null;function Se(e){Pe=e}function ke(){return null===Pe?I.local():Pe}export{W as Coder,ge as Program,I as Provider,M as Wallet,ke as getProvider,Se as setProvider,ye as utils,be as workspace};
//# sourceMappingURL=index.esm.js.map
